<AuMainContainer as |m|>
  <m.sidebar>
    <Sidebar>
      <div class="au-c-sidebar__content">
        <ul class="au-c-list-navigation">
          <li class="au-c-list-navigation__item">
            <AuNavigationLink @route="dashboard.index" role="menuitem">
              <AuIcon @icon="tiles" @alignment="left" />
              Overzicht
            </AuNavigationLink>
          </li>
          <li class="au-c-list-navigation__item">
            <AuNavigationLink @route="dashboard.favorites" role="menuitem">
              <AuIcon @icon="star-filled" @alignment="left" />
              Favorieten
            </AuNavigationLink>
          </li>
        </ul>
        <div class="au-o-box au-o-box--small">
          <ConceptSchemeFilter
            @label="Type"
            @conceptScheme={{this.serviceTypeConceptScheme}}
            @selected={{this.typeRecords}}
            @onChange={{this.updateServiceTypeFilter}} />
        </div>
        <div class="au-o-box au-o-box--small">
          <ConceptSchemeFilter
            @label="Thematisch"
            @conceptScheme={{this.themeConceptScheme}}
            @selected={{this.themeRecords}}
            @onChange={{this.updateThemeFilter}} />
        </div>
        <div class="au-o-box au-o-box--small">
          <AuFieldset as |f|>
            <f.legend>Deadline</f.legend>
            <f.content>
              <AuCheckboxGroup
                @name="deadline"
                @selected={{this.deadline}}
                @onChange={{this.updateDeadlineFilter}} as |Group|>
                {{#each this.deadlineOptions as |opt|}}
                  <Group.Checkbox @value={{opt.value}}>{{opt.label}}</Group.Checkbox>
                {{/each}}
              </AuCheckboxGroup>
            </f.content>
          </AuFieldset>
        </div>
      </div>
    </Sidebar>
  </m.sidebar>
  <m.content>
    <AuBodyContainer class="au-u-background-gray-100" >
      <AuToolbar @border="bottom" @size="small" as |Group|>
        <Group class="au-u-1-1">
          <form {{on "submit" this.search}} class="c-navigation-search">
            <div>
              <AuLabel for="search">Trefwoord</AuLabel>
              <AuInput
                id="search"
                value={{this.searchTermBuffer}}
                @width="block"
                {{on "input" this.updateSearchTermBuffer}} />
            </div>
            <AuButton
              type="submit"
              @icon="search">
              Zoek
            </AuButton>
          </form>
        </Group>
      </AuToolbar>
      {{#if this.searchTerm}}
        <AuToolbar @border="bottom" @size="medium" as |Group|>
          <Group>
            <p class="au-u-h6">{{@model.meta.count}} resultaten voor <strong>'{{this.searchTerm}}'</strong></p>
          </Group>
        </AuToolbar>
      {{/if}}
      <AuBodyContainer @scroll={{true}}>
        <div class="au-o-box au-o-box--small">
          <AuList as |listitem|>
            {{#each @model as |publicService|}}
              {{!-- TODO: item.favorite --}}
              {{!-- TODO: item.link: publicService.seeAlso.url --}}
              {{!-- TODO: sanitize publicService.description --}}
              <listitem>
                <AuCard @size="small" class="c-overview-card" as |card|>
                  <card.header class="au-u-padding-bottom-none">
                    <div class="c-overview-card__header">
                      <div class="au-u-flex au-u-flex--vertical-center au-u-flex--spaced-tiny">
                        <Favorite @active={{publicService.favorite}} />
                        <AuLinkExternal href={{publicService.link}} class="au-u-h6 au-u-medium c-overview-card__link">
                          {{publicService.name.default}}
                        </AuLinkExternal>
                      </div>
                      <div class="au-u-flex au-u-flex--spaced-tiny">
                        {{#if publicService.endDate}}
                          <AuPill @skin="warning" @size="small">Deadline: {{format-date publicService.endDate}}</AuPill>
                        {{else}}
                          <AuPill @skin="default" @size="small">Doorlopend inschrijven</AuPill>
                        {{/if}}
                        {{#if publicService.thematicAreas}}
                          {{#each publicService.thematicAreas as |theme|}}
                            <AuPill @skin="border" @size="small">
                              {{theme.label}}
                            </AuPill>
                          {{/each}}
                        {{/if}}
                        {{#if publicService.type}}
                          <AuPill @skin="border" @size="small">
                            {{publicService.type.label}}
                          </AuPill>
                        {{/if}}
                      </div>
                    </div>
                  </card.header>
                  <card.content>
                    <p class="au-u-h-functional au-u-margin-bottom-tiny">{{{publicService.description.default}}}</p>
                    {{#if publicService.link}}
                      <p class="au-u-h-functional au-u-margin-top-tiny">
                        <AuLinkExternal @icon="external-link" @iconAlignment="right" href={{publicService.link}} class="c-external">
                          Naar de {{#if publicService.type}}tool{{else}}subsidie{{/if}}
                        </AuLinkExternal>
                      </p>
                    {{/if}}
                  </card.content>
                </AuCard>
              </listitem>
            {{else}}
              <AuAlert
                @title="Niet gevonden wat je zocht?"
                @skin={{this.skin}}
                @icon="circle-question"
                @size={{this.size}}
                @closable={{this.closable}}
                @onClose={{this.onClose}}
              >
                <p>Laat ons weten welke diensten je mist op <a href="#!" class="au-c-link">LoketLokaalBestuur@vlaanderen.be.</a></p>
              </AuAlert>
            {{/each}}
          </AuList>
        </div>
      </AuBodyContainer>

      <Pagination
        @page={{this.page}}
        @size={{this.size}}
        @total={{this.model.meta.count}}
        @onChange={{this.setPage}}
        @onChangeSize={{this.setPageSize}} />
    </AuBodyContainer>
  </m.content>
</AuMainContainer>